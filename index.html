<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>

    <title>PDP-11 Playground</title>

    <!-- link rel='icon' type='image/png' href='/favicon.png' -->
    
    <script defer type="module" src='./src/main.js'></script>

<style>
.pdp11-window {
  display: flex;
}
.pdp11-window hr {
  max-width: 3rem;
  margin: 1em;
}
.dummy-gutter .cm-gutterElement { 
  margin-right: 1em
}
#log {
  line-height: 1.4;
}
p {
  max-width: 40%;
}
</style>
  </head>

  <body>
    <p>
    The editor is on the left-hand side below. The gutter has four custom
    fields: an address, and up to three words of generated code. When the
    source in the editor is changed, the program is reassembled, and the gutter
    values should update to reflect that.
    </p>
    <p>
    The right hand side shows a summary of the relevant data from the assembler
    output: the adress and the generated code. Right now I hooked it into a
    StateField so it updated on source changes.
    </p>

    <p>
    The API to assemble the code is just <code>result = assemble(source)</code>.
    Along with some housekeeping, the result has a <code>sourceLines</code>
    list. Each element is an instance of <code>AssembledLine</code>. All
    instances contain the <code>height_in_lines</code> field, which is the
    number of lines that will be needed to display this source line in the
    editor.
    </p>

    <p> If a line is an instance of <code>CodegenLine</code>, then it also
    contains an <code>address</code> field, which will be used to populate the
    address gutter, and an array of generated bytes, used to populate with word
    gutters.
    </p>

    <div class="pdp11-window">
      <div id="edit-wrapper">
        <h4>The CodeView editor</h4>
      </div>
      <hr/>
      <div id="assembled">
        <h4>The result of the assembly</h4>
        <pre id="log">
        </pre>
        <h4>The fields</h4>
        <ol>
          <li><p>
            The line number (this is just for your reference; we use the
            lineNumbers extension in the gutter)
          </p></li> 
          <li><p>
            The height of the line. If there are more that 3 generated words,
            then the gutter will display them in multiple rows of three, and
            the line height of the source code will need to be increased
            accordingly
          </p></li>
          <li><p>
            The address. If present, this goes into the "addr" gutter.
          </p></li>
          <li><p>
            <em>n</em> words of generated code. These are placed into the
            word1/2/3 gutter fields, wrapping onto a new line if needed.
          </p></li>
        </ol>
      </div>
    </div>

  </body>
</html>
